@model IEnumerable<kinder_care.Models.Usuarios>

@{
    ViewBag.Title = "Gestión de Perfiles de Usuarios";
}

<div class="breadcrumb-with-buttons mb-24 flex-between flex-wrap gap-8">
    <div class="breadcrumb mb-24">
        <ul class="flex-align gap-4">
            <li>
                <a asp-action="Index" asp-controller="Home" class="text-gray-200 fw-normal text-15 hover-text-main-600">Inicio</a>
            </li>
            <li>
                <span class="text-gray-500 fw-normal d-flex">
                    <i class="ph ph-caret-right"></i>
                </span>
            </li>
            <li>
                <span class="text-main-600 fw-normal text-15">Usuarios</span>
            </li>
        </ul>
    </div>
</div>

<!-- Buscadores -->
<div class="mb-4 d-flex gap-3 flex-wrap">
    <div class="position-relative" style="margin-right: 10px;">
        <input type="text" id="searchByName" placeholder="Buscar por nombre..." class="form-control ps-40 h-40 rounded-pill search-input"/>
        <i class="ph ph-magnifying-glass position-absolute" style="left: 10px; top: 10px; font-size: 20px; color: #aaa;"></i>
    </div>
    <div class="position-relative" style="margin-right: 10px;">
        <input type="text" id="searchByID" placeholder="Buscar por ID..." class="form-control ps-40 h-40 rounded-pill search-input"/>
        <i class="ph ph-magnifying-glass position-absolute" style="left: 10px; top: 10px; font-size: 20px; color: #aaa;"></i>
    </div>
    <div class="position-relative">
        <input type="text" id="searchByCedula" placeholder="Buscar por cédula..." class="form-control ps-40 h-40 rounded-pill search-input"/>
        <i class="ph ph-magnifying-glass position-absolute" style="left: 10px; top: 10px; font-size: 20px; color: #aaa;"></i>
    </div>
</div>

<div class="card overflow-hidden">
    <div class="card-body p-0 overflow-x-auto">
        <table id="userTable" class="table table-striped">
            <thead>
            <tr>
                <th class="h6 text-gray-300">Nombre</th>
                <th class="h6 text-gray-300">ID</th>
                <th class="h6 text-gray-300">Cédula</th>
                <th class="h6 text-gray-300">Teléfono</th>
                <th class="h6 text-gray-300">Dirección</th>
                <th class="h6 text-gray-300">Correo Electrónico</th>
                <th class="h6 text-gray-300">Tipo de Usuario</th>
                <th class="h6 text-gray-300">Acciones</th>
            </tr>
            </thead>
            <tbody>
            @foreach (var usuario in Model)
            {
                <tr>
                    <td>
                        <div class="flex-align gap-8">
                            <img src="~/images/icons/profile_icon_2.png" alt="Perfil" class="w-40 h-40 rounded-circle">
                            <span class="h6 mb-0 fw-medium text-gray-300">@usuario.Nombre</span>
                        </div>
                    </td>
                    <td>
                        <span class="h6 mb-0 fw-medium text-gray-300">@usuario.IdUsuario</span>
                    </td>
                    <td>
                        <span class="h6 mb-0 fw-medium text-gray-300">@usuario.Cedula</span>
                    </td>
                    <td>
                        <span class="h6 mb-0 fw-medium text-gray-300">@usuario.NumTelefono</span>
                    </td>
                    <td>
                        <span class="h6 mb-0 fw-medium text-gray-300">@usuario.Direccion</span>
                    </td>
                    <td>
                        <span class="h6 mb-0 fw-medium text-gray-300">@usuario.CorreoElectronico</span>
                    </td>
                    <td>
                        <span class="h6 mb-0 fw-medium text-gray-300">
                            @usuario.IdRolNavigation?.Nombre
                        </span>
                    </td>
                    <td>
                        <a asp-action="Details" asp-route-id="@usuario.IdUsuario" class="btn btn-main rounded-pill">Ver Más</a>
                    </td>
                </tr>
            }
            </tbody>
        </table>
    </div>
</div>

<!-- Paginación -->
<div class="d-flex justify-content-between mb-2">
    <span id="infoContainer" class="text-gray-900"></span>
    <select id="entriesSelect" class="form-select" style="width: 100px;">
        <option value="5">5</option>
        <option value="10" selected>10</option>
        <option value="20">20</option>
        <option value="50">50</option>
    </select>
    <ul class="pagination mb-0"></ul>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const table = document.getElementById('userTable');
        const searchByName = document.getElementById('searchByName');
        const searchByID = document.getElementById('searchByID');
        const searchByCedula = document.getElementById('searchByCedula');
        const paginationContainer = document.querySelector('.pagination');
        const infoContainer = document.getElementById('infoContainer');
        const entriesSelect = document.getElementById('entriesSelect');

        const rows = Array.from(document.querySelectorAll('#userTable tbody tr'));
        let pageSize = parseInt(entriesSelect.value);
        let currentPage = 1;
        let filteredRows = rows;

        // Filtrado
        function filterRows() {
            const nameValue = searchByName.value.toLowerCase();
            const idValue = searchByID.value.toLowerCase();
            const cedulaValue = searchByCedula.value.toLowerCase();

            filteredRows = rows.filter(row => {
                const name = row.children[0].textContent.toLowerCase();
                const id = row.children[1].textContent.toLowerCase();
                const cedula = row.children[2].textContent.toLowerCase();
                return name.includes(nameValue) && id.includes(idValue) && cedula.includes(cedulaValue);
            });

            currentPage = 1;
            renderTable();
        }

        function renderTable() {
            const total = filteredRows.length;
            const totalPages = Math.ceil(total / pageSize);
            const start = (currentPage - 1) * pageSize;
            const end = start + pageSize;

            rows.forEach(row => row.style.display = 'none');
            filteredRows.slice(start, end).forEach(row => row.style.display = '');

            infoContainer.textContent = `Mostrando ${start + 1} a ${Math.min(end, total)} de ${total} registros`;
            renderPagination(totalPages);
        }

        function renderPagination(totalPages) {
            paginationContainer.innerHTML = '';
            for (let i = 1; i <= totalPages; i++) {
                paginationContainer.innerHTML += `<li class="page-item ${i === currentPage ? 'active' : ''}">
                    <a href="#" class="page-link" data-page="${i}">${i}</a>
                </li>`;
            }

            paginationContainer.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', e => {
                    e.preventDefault();
                    currentPage = parseInt(link.dataset.page);
                    renderTable();
                });
            });
        }

        entriesSelect.addEventListener('change', () => {
            pageSize = parseInt(entriesSelect.value);
            currentPage = 1;
            renderTable();
        });

        searchByName.addEventListener('keyup', filterRows);
        searchByID.addEventListener('keyup', filterRows);
        searchByCedula.addEventListener('keyup', filterRows);

        renderTable();
    });
</script>