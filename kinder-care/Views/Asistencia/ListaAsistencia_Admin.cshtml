@model IEnumerable<kinder_care.Models.Asistencia>

<div class="breadcrumb-with-buttons mb-24 flex-between flex-wrap gap-8">
    <!-- Breadcrumb -->
    <div class="breadcrumb mb-24">
        <ul class="flex-align gap-4">
            <li>
                <a asp-action="Index" asp-controller="Home" class="text-gray-200 fw-normal text-15 hover-text-main-600">Inicio</a>
            </li>
            <li>
                <span class="text-gray-500 fw-normal d-flex">
                    <i class="ph ph-caret-right"></i>
                </span>
            </li>
            <li>
                <span class="text-main-600 fw-normal text-15">Historial de Asistencias</span>
            </li>
        </ul>
    </div>
</div>

<!-- Formulario de filtros -->
<form asp-action="ListaAsistencia" method="get" class="card mb-24 p-16">
    <div class="row">
        <div class="col-md-4">
            <label for="fechaInicio" class="form-label">Fecha Inicio</label>
            <input type="date" name="fechaInicio" id="fechaInicio" class="form-control"
                   value="@ViewBag.FechaInicio"/>
        </div>
        <div class="col-md-4">
            <label for="fechaFin" class="form-label">Fecha Fin</label>
            <input type="date" name="fechaFin" id="fechaFin" class="form-control"
                   value="@ViewBag.FechaFin"/>
        </div>
        <div class="col-md-4 d-flex align-items-end">
            <button type="submit" class="btn btn-main w-100">Filtrar</button>
        </div>
    </div>
</form>

<!-- Tabla con resultados -->
<div class="card overflow-hidden">
    <div class="card-body p-0 overflow-x-auto">
        <table id="attendanceTable" class="table table-striped">
            <thead>
                <tr>
                    <th class="h6 text-gray-300">ID Niño</th>
                    <th class="h6 text-gray-300">Estudiante</th>
                    <th class="h6 text-gray-300">Fecha</th>
                    <th class="h6 text-gray-300">Presente</th>
                </tr>
            </thead>
            <tbody>
                @if (!Model.Any())
                {
                    <tr>
                        <td colspan="4" class="text-center text-gray-500">No se encontraron registros.</td>
                    </tr>
                }
                else
                {
                    @foreach (var asistencia in Model)
                    {
                        <tr>
                            <td>
                                <span class="h6 mb-0 fw-medium text-gray-300">@asistencia.IdNino</span>
                            </td>
                            <td>
                                <span class="h6 mb-0 fw-medium text-gray-300">@asistencia.IdNinoNavigation.NombreNino</span>
                            </td>
                            <td>
                                <span class="h6 mb-0 fw-medium text-gray-300">@asistencia.Fecha.ToString("yyyy-MM-dd")</span>
                            </td>
                            <td>
                                <span class="h6 mb-0 fw-medium @(asistencia.Presente ? "text-success" : "text-danger")">
                                    @(asistencia.Presente ? "Presente" : "Ausente")
                                </span>
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>
</div>

<!-- Paginación -->
<div class="d-flex justify-content-between mb-2">
    <span id="infoContainer" class="text-gray-900"></span>
    <select id="entriesSelect" class="form-select" style="width: 100px;">
        <option value="5">5</option>
        <option value="10" selected>10</option>
        <option value="20">20</option>
        <option value="50">50</option>
    </select>
    <ul class="pagination mb-0"></ul>
</div>

<!-- Botón para generar PDF -->
<div class="card-footer d-flex justify-content-end">
    <form asp-action="GenerarReportePdf" asp-controller="Asistencia" method="get">
        <input type="hidden" name="fechaInicio" value="@ViewBag.FechaInicio" />
        <input type="hidden" name="fechaFin" value="@ViewBag.FechaFin" />
        <button type="submit" class="btn btn-primary">Generar PDF</button>
    </form>
</div>


<style>
    .form-control {
        font-size: 16px;
        border: 1px solid #e0e0e0;
        padding: 8px 16px;
    }

    .btn-main {
        background-color: #007bff;
        color: white;
        padding: 6px 12px;
        text-decoration: none;
        border-radius: 50px;
        font-size: 14px;
    }

    .btn-main:hover {
        background-color: #0056b3;
    }

    .table th, .table td {
        padding: 12px;
        vertical-align: middle;
        text-align: left;
    }

    .pagination .page-link {
        color: #007bff;
        margin: 0 3px;
    }

    .pagination .page-link:hover {
        background-color: #f8f9fa;
    }

    .pagination .active .page-link {
        background-color: #007bff;
        color: white;
        border: 1px solid #007bff;
    }

    .btn-danger {
        margin-left: 5px;
    }

    .search-input {
        width: 300px;
        max-width: 100%;
    }

    .mb-4 {
        margin-bottom: 20px;
    }

    .d-flex.gap-3 > div {
        margin-bottom: 10px;
    }

    .table-striped tbody tr {
        margin-bottom: 10px;
        display: table-row;
    }

    .pagination {
        margin-top: 1rem;
        justify-content: center;
        font-family: 'Roboto', sans-serif;
    }

    .pagination .page-item {
        margin: 0 4px;
    }

    .pagination .page-link {
        color: #007bff;
        border: 1px solid #dee2e6;
        padding: 6px 12px;
        font-size: 14px;
        border-radius: 8px;
        transition: all 0.2s ease-in-out;
    }

    .pagination .page-link:hover {
        background-color: #007bff;
        color: #fff;
        text-decoration: none;
    }

    .pagination .active .page-link {
        background-color: #007bff;
        border-color: #007bff;
        color: #fff;
    }

    .pagination .page-item.disabled .page-link {
        color: #6c757d;
        pointer-events: none;
        background-color: #f8f9fa;
    }
</style>

<!-- Script -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const paginationContainer = document.querySelector('.pagination');
        const infoContainer = document.getElementById('infoContainer');
        const entriesSelect = document.getElementById('entriesSelect');

        const rows = Array.from(document.querySelectorAll('#attendanceTable tbody tr'));
        let pageSize = parseInt(entriesSelect.value);
        let currentPage = 1;

        function renderTable() {
            const total = rows.length;
            const totalPages = Math.ceil(total / pageSize);
            const start = (currentPage - 1) * pageSize;
            const end = start + pageSize;

            rows.forEach(row => row.style.display = 'none');
            rows.slice(start, end).forEach(row => row.style.display = '');

            infoContainer.textContent = `Mostrando ${start + 1} a ${Math.min(end, total)} de ${total} registros`;
            
            renderPagination(totalPages);
        }

        function renderPagination(totalPages) {
            paginationContainer.innerHTML = '';
            
            if (currentPage > 1) {
                paginationContainer.innerHTML += `<li class="page-item"><a href="#" data-page="${currentPage - 1}">Anterior</a></li>`;
            }

            for (let i = 1; i <= totalPages; i++) {
                paginationContainer.innerHTML += `<li class="page-item ${i === currentPage ? 'active' : ''}">
                <a href="#" data-page="${i}">${i}</a></li>`;
            }

            if (currentPage < totalPages) {
                paginationContainer.innerHTML += `<li class="page-item"><a href="#" data-page="${currentPage + 1}">Siguiente</a></li>`;
            }

            paginationContainer.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', function (e) {
                    e.preventDefault();
                    currentPage = parseInt(link.dataset.page);
                    renderTable();
                });
            });
        }

        entriesSelect.addEventListener('change', () => {
            pageSize = parseInt(entriesSelect.value);
            currentPage = 1;
            renderTable();
        });

        renderTable();
    });
</script>
