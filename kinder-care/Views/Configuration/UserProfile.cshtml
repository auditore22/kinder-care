@{
ViewBag.Title = "Perfil de Usuario";
Layout = "_SecondaryLayout";
}

<section id="userProfile" class="wrapper style1 fullscreen fade-up">
    <div class="inner">
        <h2>Perfil de Usuario</h2>
        <p>Consulta y actualiza tu información de perfil.</p>

        <!-- Mostrar mensajes de error o éxito -->
        @if (TempData["ErrorMessage"] != null)
        {
        <div class="alert alert-danger">
            <span>@TempData["ErrorMessage"]</span>
        </div>
        }
        @if (TempData["SuccessMessage"] != null)
        {
        <div class="alert alert-success">
            <span>@TempData["SuccessMessage"]</span>
        </div>
        }

        <form method="post" action="@Url.Action("SaveProfile", "Configuration")" enctype="multipart/form-data">
            <div class="row gtr-uniform">
                <div class="col-6 col-12-small">
                    <div class="profile-picture-wrapper">
                        <img src="~/images/default-profile.png" alt="Imagen de Perfil" id="profileImage" class="profile-picture" />
                        <div class="profile-picture-actions">
                            <label for="profileImageUpload" class="button small">Cambiar Imagen</label>
                            <input type="file" name="profileImageUpload" id="profileImageUpload" accept="image/*" style="display:none;" />
                            <button type="button" class="button small alt" id="removeImage">Eliminar Imagen</button>
                        </div>
                    </div>
                </div>
                <div class="col-6 col-12-small">
                    <label for="userName">Nombre Completo</label>
                    <input type="text" name="userName" id="userName" value="Juan Perez" placeholder="Nombre Completo" />
                </div>
                <div class="col-6 col-12-xsmall">
                    <label for="userEmail">Correo Electrónico</label>
                    <input type="email" name="userEmail" id="userEmail" value="juan.perez@example.com" placeholder="Correo Electrónico" />
                </div>
                <div class="col-6 col-12-xsmall">
                    <label for="userPhone">Teléfono</label>
                    <input type="text" name="userPhone" id="userPhone" value="+506 8888 8888" placeholder="Número de Teléfono" />
                </div>

                <!-- Botón para cambiar contraseña -->
                <div class="col-12">
                    <button type="button" class="button small" id="changePasswordButton" style="font-size: 12px;">Cambiar Contraseña</button>
                </div>

                <!-- Campos ocultos para cambiar contraseña -->
                <div id="passwordFields" style="display: none;">
                    <!-- Contraseña Actual -->
                    <div class="col-6 col-12-xsmall">
                        <label for="currentPassword">Contraseña Actual</label>
                        <div class="input-group password-wrapper">
                            <input type="password" name="currentPassword" id="currentPassword" class="form-control" />
                            <button class="btn toggle-password" type="button" data-target="#currentPassword">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        @if (ViewData.ModelState["CurrentPassword"] != null && ViewData.ModelState["CurrentPassword"].Errors.Count > 0)
                        {
                        <span class="text-danger">@ViewData.ModelState["CurrentPassword"].Errors[0].ErrorMessage</span>
                        }
                    </div>

                    <!-- Nueva Contraseña -->
                    <div class="col-6 col-12-xsmall">
                        <label for="newPassword">Nueva Contraseña</label>
                        <div class="input-group password-wrapper">
                            <input type="password" name="newPassword" id="newPassword" class="form-control" />
                            <button class="btn toggle-password" type="button" data-target="#newPassword">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        @if (ViewData.ModelState["NewPassword"] != null && ViewData.ModelState["NewPassword"].Errors.Count > 0)
                        {
                        <span class="text-danger">@ViewData.ModelState["NewPassword"].Errors[0].ErrorMessage</span>
                        }
                    </div>

                    <!-- Confirmar Nueva Contraseña -->
                    <div class="col-6 col-12-xsmall">
                        <label for="confirmPassword">Confirmar Nueva Contraseña</label>
                        <div class="input-group password-wrapper">
                            <input type="password" name="confirmPassword" id="confirmPassword" class="form-control" />
                            <button class="btn toggle-password" type="button" data-target="#confirmPassword">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        @if (ViewData.ModelState["ConfirmPassword"] != null && ViewData.ModelState["ConfirmPassword"].Errors.Count > 0)
                        {
                        <span class="text-danger">@ViewData.ModelState["ConfirmPassword"].Errors[0].ErrorMessage</span>
                        }
                    </div>
                </div>

                <div class="col-12">
                    <ul class="actions">
                        <li><input type="submit" value="Actualizar Perfil" class="primary" /></li>
                    </ul>
                </div>
            </div>
        </form>
    </div>
</section>

<style>
    .profile-picture-wrapper {
        text-align: center;
    }

    .profile-picture {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid #ddd;
        margin-bottom: 10px;
    }

    .profile-picture-actions {
        display: flex;
        justify-content: center;
        gap: 10px;
    }

    #profileImageUpload {
        display: none;
    }

    .input-group {
        position: relative;
        display: flex;
        align-items: center;
    }

    .input-group .form-control {
        flex-grow: 1;
        border-right: 0;
    }

    .input-group .btn {
        background-color: transparent;
        border: none;
        margin-left: 10px;
        font-size: 10px;
        padding: 5px;
    }

    .input-group .btn i {
        font-size: 16px;
    }

    .input-group .form-control:focus {
        z-index: 2;
    }

    .text-danger {
        color: red;
        font-size: 12px;
    }

    .alert {
        padding: 10px;
        margin-bottom: 20px;
        border-radius: 5px;
    }

    .alert-danger {
        background-color: #f8d7da;
        color: #721c24;
    }

    .alert-success {
        background-color: #d4edda;
        color: #155724;
    }
</style>

<script>
    // Mostrar/Ocultar campos de cambio de contraseña
    document.getElementById("changePasswordButton").addEventListener("click", function() {
        var passwordFields = document.getElementById("passwordFields");
        if (passwordFields.style.display === "none") {
            passwordFields.style.display = "block";
        } else {
            passwordFields.style.display = "none";
        }
    });

    // Alternar visibilidad de la contraseña
    document.querySelectorAll(".toggle-password").forEach(button => {
        button.addEventListener("click", function() {
            const target = document.querySelector(this.getAttribute("data-target"));
            const type = target.getAttribute("type") === "password" ? "text" : "password";
            target.setAttribute("type", type);

            this.querySelector("i").classList.toggle("fa-eye");
            this.querySelector("i").classList.toggle("fa-eye-slash");
        });
    });

    // Previsualización de la imagen de perfil subida
    document.getElementById("profileImageUpload").addEventListener("change", function() {
        const [file] = this.files;
        if (file) {
            document.getElementById("profileImage").src = URL.createObjectURL(file);
        }
    });

    // Eliminar imagen de perfil
    document.getElementById("removeImage").addEventListener("click", function() {
        document.getElementById("profileImage").src = "~/images/default-profile.png";
        document.getElementById("profileImageUpload").value = null;
    });
</script>

<!-- Asegúrate de incluir las referencias a los scripts de validación -->
<script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
<script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>

